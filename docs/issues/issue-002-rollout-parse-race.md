# [中] rollout 解析并发竞态导致统计不稳定

## 概要
文件变更回调与主循环都可能同时调用 `rolloutParser.parse()`，没有串行化保护，可能出现 `lastOffset`/`cachedResult` 被旧结果覆盖，造成统计丢失或重复。

## 影响
- HUD 统计不稳定，工具调用计数/最近调用展示异常。
- 难以复现与定位问题。

## 位置
- `src/index.ts:191`
- `src/index.ts:291`
- `src/collectors/rollout.ts:302`

## 复现步骤
1. 在活跃会话中高频触发工具调用（产生密集的 rollout 记录）。
2. 同时触发文件 watcher 与主循环解析。

## 预期结果
解析过程串行，缓存状态一致。

## 实际结果
统计可能丢失或重复。

## 修复建议
- 为 `rolloutParser.parse()` 加互斥/队列（单飞机制）。
- 仅保留一个解析触发入口（其他入口改为标记“需刷新”）。

## 修复记录
- 状态：已修复
- 修复人：codex
- 修复时间：2026-01-29
- 变更说明：为解析引入单飞队列，避免 watcher 与主循环并发解析。
- 验证方式：未执行；建议高频触发工具调用观察统计稳定性。
